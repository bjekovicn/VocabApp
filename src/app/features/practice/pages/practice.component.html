<div class="min-h-screen bg-gray-50 py-8 px-4 sm:px-6 lg:px-8">
  <div class="max-w-4xl mx-auto">
    <!-- Setup State -->
    @if (state() === 'setup') {
      <div class="mb-10 text-center sm:text-left">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-3">VeÅ¾banje</h1>
        <p class="text-gray-600 text-lg sm:text-base">Izaberi mod i listu za veÅ¾banje</p>
      </div>

      <app-custom-card class="shadow-lg">
        <div class="p-6 md:p-8 space-y-8">
          <!-- Pravac (Direction) -->
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Pravac</label>
            <div class="grid grid-cols-2 gap-3">
              <button
                type="button"
                (click)="selectedDirection.set('source-target')"
                [class]="
                  selectedDirection() === 'source-target'
                    ? 'flex flex-col items-center justify-center gap-1 px-4 py-4 rounded-xl border-2 border-primary-500 bg-primary-50 text-primary-700 font-semibold transition-all shadow-sm'
                    : 'flex flex-col items-center justify-center gap-1 px-4 py-4 rounded-xl border-2 border-gray-200 bg-white text-gray-600 font-medium hover:border-gray-300 hover:bg-gray-50 transition-all'
                "
              >
                <span class="text-xs font-bold tracking-wide">source â†’ target</span>
              </button>

              <button
                type="button"
                (click)="selectedDirection.set('target-source')"
                [class]="
                  selectedDirection() === 'target-source'
                    ? 'flex flex-col items-center justify-center gap-1 px-4 py-4 rounded-xl border-2 border-primary-500 bg-primary-50 text-primary-700 font-semibold transition-all shadow-sm'
                    : 'flex flex-col items-center justify-center gap-1 px-4 py-4 rounded-xl border-2 border-gray-200 bg-white text-gray-600 font-medium hover:border-gray-300 hover:bg-gray-50 transition-all'
                "
              >
                <span class="text-xs font-bold tracking-wide">target â†’ source</span>
              </button>
            </div>
          </div>

          <!-- Tip veÅ¾banja (Type) -->
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Tip veÅ¾banja</label>
            <div class="grid grid-cols-2 gap-3">
              <button
                type="button"
                (click)="selectedType.set('flip-card')"
                [class]="
                  selectedType() === 'flip-card'
                    ? 'flex flex-col items-center justify-center gap-1 px-4 py-4 rounded-xl border-2 border-primary-500 bg-primary-50 text-primary-700 font-semibold transition-all shadow-sm'
                    : 'flex flex-col items-center justify-center gap-1 px-4 py-4 rounded-xl border-2 border-gray-200 bg-white text-gray-600 font-medium hover:border-gray-300 hover:bg-gray-50 transition-all'
                "
              >
                <span class="text-2xl">ğŸƒ</span>
                <span class="text-sm">Flip Card</span>
              </button>

              <button
                type="button"
                (click)="selectedType.set('quiz')"
                [class]="
                  selectedType() === 'quiz'
                    ? 'flex flex-col items-center justify-center gap-1 px-4 py-4 rounded-xl border-2 border-primary-500 bg-primary-50 text-primary-700 font-semibold transition-all shadow-sm'
                    : 'flex flex-col items-center justify-center gap-1 px-4 py-4 rounded-xl border-2 border-gray-200 bg-white text-gray-600 font-medium hover:border-gray-300 hover:bg-gray-50 transition-all'
                "
              >
                <span class="text-2xl">ğŸ“</span>
                <span class="text-sm">Quiz</span>
              </button>
            </div>
          </div>

          <!-- Redosled reÄi -->
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Redosled reÄi</label>
            <div class="grid grid-cols-2 gap-3">
              <button
                type="button"
                (click)="shuffleEnabled.set(true)"
                [class]="
                  shuffleEnabled()
                    ? 'flex flex-col items-center justify-center gap-1 px-4 py-4 rounded-xl border-2 border-primary-500 bg-primary-50 text-primary-700 font-semibold transition-all shadow-sm'
                    : 'flex flex-col items-center justify-center gap-1 px-4 py-4 rounded-xl border-2 border-gray-200 bg-white text-gray-600 font-medium hover:border-gray-300 hover:bg-gray-50 transition-all'
                "
              >
                <span class="text-2xl">ğŸ”€</span>
                <span class="text-sm">NasumiÄno</span>
              </button>

              <button
                type="button"
                (click)="shuffleEnabled.set(false)"
                [class]="
                  !shuffleEnabled()
                    ? 'flex flex-col items-center justify-center gap-1 px-4 py-4 rounded-xl border-2 border-primary-500 bg-primary-50 text-primary-700 font-semibold transition-all shadow-sm'
                    : 'flex flex-col items-center justify-center gap-1 px-4 py-4 rounded-xl border-2 border-gray-200 bg-white text-gray-600 font-medium hover:border-gray-300 hover:bg-gray-50 transition-all'
                "
              >
                <span class="text-2xl">ğŸ“‹</span>
                <span class="text-sm">Po redu</span>
              </button>
            </div>
          </div>

          <!-- Lista -->
          <div class="space-y-1">
            <app-custom-select
              label="Lista"
              placeholder="Sve liste"
              [options]="listOptions()"
              [(value)]="selectedListId"
            />
          </div>

          <!-- Filter reÄi -->
          <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Filter reÄi</label>
            <div class="grid grid-cols-2 gap-3">
              <!-- Sve reÄi -->
              <button
                type="button"
                (click)="selectedFilter.set('all')"
                [class]="
                  selectedFilter() === 'all'
                    ? 'flex flex-col items-center justify-center gap-1 px-4 py-3 rounded-xl border-2 border-primary-500 bg-primary-50 text-primary-700 font-semibold transition-all shadow-sm'
                    : 'flex flex-col items-center justify-center gap-1 px-4 py-3 rounded-xl border-2 border-gray-200 bg-white text-gray-600 font-medium hover:border-gray-300 hover:bg-gray-50 transition-all'
                "
              >
                <span class="text-xl">ğŸ“š</span>
                <span class="text-sm">Sve reÄi</span>
                <span
                  class="text-xs font-bold px-2 py-0.5 rounded-full"
                  [class]="
                    selectedFilter() === 'all'
                      ? 'bg-primary-100 text-primary-700'
                      : 'bg-gray-100 text-gray-500'
                  "
                >
                  {{ filterCounts().all }}
                </span>
              </button>

              <!-- Najslabije -->
              <button
                type="button"
                (click)="selectedFilter.set('weakest')"
                [class]="
                  selectedFilter() === 'weakest'
                    ? 'flex flex-col items-center justify-center gap-1 px-4 py-3 rounded-xl border-2 border-primary-500 bg-primary-50 text-primary-700 font-semibold transition-all shadow-sm'
                    : filterCounts().weakest === 0
                      ? 'flex flex-col items-center justify-center gap-1 px-4 py-3 rounded-xl border-2 border-gray-100 bg-gray-50 text-gray-400 font-medium cursor-not-allowed transition-all'
                      : 'flex flex-col items-center justify-center gap-1 px-4 py-3 rounded-xl border-2 border-gray-200 bg-white text-gray-600 font-medium hover:border-gray-300 hover:bg-gray-50 transition-all'
                "
                [disabled]="filterCounts().weakest === 0"
              >
                <span class="text-xl">ğŸ“‰</span>
                <span class="text-sm">Najslabije</span>
                <span
                  class="text-xs font-bold px-2 py-0.5 rounded-full"
                  [class]="
                    selectedFilter() === 'weakest'
                      ? 'bg-primary-100 text-primary-700'
                      : filterCounts().weakest === 0
                        ? 'bg-gray-100 text-gray-400'
                        : 'bg-red-100 text-red-600'
                  "
                >
                  {{ filterCounts().weakest }}
                </span>
              </button>

              <!-- Zaboravljene -->
              <button
                type="button"
                (click)="selectedFilter.set('forgotten')"
                [class]="
                  selectedFilter() === 'forgotten'
                    ? 'flex flex-col items-center justify-center gap-1 px-4 py-3 rounded-xl border-2 border-primary-500 bg-primary-50 text-primary-700 font-semibold transition-all shadow-sm'
                    : filterCounts().forgotten === 0
                      ? 'flex flex-col items-center justify-center gap-1 px-4 py-3 rounded-xl border-2 border-gray-100 bg-gray-50 text-gray-400 font-medium cursor-not-allowed transition-all'
                      : 'flex flex-col items-center justify-center gap-1 px-4 py-3 rounded-xl border-2 border-gray-200 bg-white text-gray-600 font-medium hover:border-gray-300 hover:bg-gray-50 transition-all'
                "
                [disabled]="filterCounts().forgotten === 0"
              >
                <span class="text-xl">ğŸ•°ï¸</span>
                <span class="text-sm">Zaboravljene</span>
                <span
                  class="text-xs font-bold px-2 py-0.5 rounded-full"
                  [class]="
                    selectedFilter() === 'forgotten'
                      ? 'bg-primary-100 text-primary-700'
                      : filterCounts().forgotten === 0
                        ? 'bg-gray-100 text-gray-400'
                        : 'bg-orange-100 text-orange-600'
                  "
                >
                  {{ filterCounts().forgotten }}
                </span>
              </button>

              <!-- Nove -->
              <button
                type="button"
                (click)="selectedFilter.set('new')"
                [class]="
                  selectedFilter() === 'new'
                    ? 'flex flex-col items-center justify-center gap-1 px-4 py-3 rounded-xl border-2 border-primary-500 bg-primary-50 text-primary-700 font-semibold transition-all shadow-sm'
                    : filterCounts().new === 0
                      ? 'flex flex-col items-center justify-center gap-1 px-4 py-3 rounded-xl border-2 border-gray-100 bg-gray-50 text-gray-400 font-medium cursor-not-allowed transition-all'
                      : 'flex flex-col items-center justify-center gap-1 px-4 py-3 rounded-xl border-2 border-gray-200 bg-white text-gray-600 font-medium hover:border-gray-300 hover:bg-gray-50 transition-all'
                "
                [disabled]="filterCounts().new === 0"
              >
                <span class="text-xl">âœ¨</span>
                <span class="text-sm">Nove</span>
                <span
                  class="text-xs font-bold px-2 py-0.5 rounded-full"
                  [class]="
                    selectedFilter() === 'new'
                      ? 'bg-primary-100 text-primary-700'
                      : filterCounts().new === 0
                        ? 'bg-gray-100 text-gray-400'
                        : 'bg-green-100 text-green-600'
                  "
                >
                  {{ filterCounts().new }}
                </span>
              </button>
            </div>
          </div>

          <!-- Dugme -->
          <div class="pt-2">
            <app-custom-button
              variant="primary"
              [fullWidth]="true"
              [disabled]="availableWords().length === 0"
              (clicked)="startPractice()"
            >
              PoÄni VeÅ¾banje
              @if (availableWords().length > 0) {
                <span class="ml-2 text-sm opacity-75">({{ availableWords().length }} reÄi)</span>
              }
            </app-custom-button>
          </div>
        </div>
      </app-custom-card>
    }

    <!-- Practicing State -->
    @if (state() === 'practicing') {
      <div class="mt-6">
        @if (
          selectedMode() === 'flip-card-source-target' ||
          selectedMode() === 'flip-card-target-source'
        ) {
          <app-flip-card-practice
            [words]="practiceWords()"
            [mode]="selectedMode()"
            (finished)="handlePracticeFinished($event)"
          />
        }

        @if (selectedMode() === 'quiz-source-target' || selectedMode() === 'quiz-target-source') {
          <app-quiz-practice
            [words]="practiceWords()"
            [mode]="selectedMode()"
            (finished)="handlePracticeFinished($event)"
          />
        }
      </div>
    }

    <!-- Results State -->
    @if (state() === 'results') {
      <div class="mb-8 text-center sm:text-left">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-gray-900 mb-2">Rezultati</h1>
        <p class="text-gray-600 text-lg sm:text-base">OdliÄan rad!</p>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8">
        <app-custom-card class="shadow-md">
          <div class="text-center py-6">
            <div class="text-4xl font-bold text-gray-900">{{ stats().totalWords }}</div>
            <div class="text-sm text-gray-500 mt-2 uppercase tracking-wide">Ukupno reÄi</div>
          </div>
        </app-custom-card>

        <app-custom-card class="shadow-md">
          <div class="text-center py-6">
            <div class="text-4xl font-bold text-green-600">{{ stats().correctCount }}</div>
            <div class="text-sm text-gray-500 mt-2 uppercase tracking-wide">TaÄno</div>
          </div>
        </app-custom-card>

        <app-custom-card class="shadow-md">
          <div class="text-center py-6">
            <div class="text-4xl font-bold text-primary-600">{{ stats().accuracy }}%</div>
            <div class="text-sm text-gray-500 mt-2 uppercase tracking-wide">TaÄnost</div>
          </div>
        </app-custom-card>
      </div>

      <!-- Action Buttons -->
      <div class="flex flex-col sm:flex-row gap-4">
        <app-custom-button variant="primary" [fullWidth]="true" (clicked)="restartPractice()">
          Novo VeÅ¾banje
        </app-custom-button>
        <app-custom-button variant="secondary" [fullWidth]="true" (clicked)="goHome()">
          Nazad
        </app-custom-button>
      </div>
    }
  </div>
</div>
